{% extends "base.html" %}
{% block content %}
<main id="main" class="main">

  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title text-primary">{{ exercice.titre }}</h5>

      <!-- Vertical Pills Tabs -->
      <div class="d-flex align-items-start">
        <!-- Navigation des onglets -->
        <div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
          <button class="nav-link active" id="v-pills-home-tab" data-bs-toggle="pill" data-bs-target="#v-pills-home" type="button" role="tab" aria-controls="v-pills-home" aria-selected="true">Enoncé</button>
          <button class="nav-link" id="v-pills-profile-tab" data-bs-toggle="pill" data-bs-target="#v-pills-profile" type="button" role="tab" aria-controls="v-pills-profile" aria-selected="false">Aide</button>
          <button class="nav-link" id="v-pills-solution-tab" data-bs-toggle="pill" data-bs-target="#v-pills-solution" type="button" role="tab" aria-controls="v-pills-solution" aria-selected="false">Solution</button>
        </div>

        <!-- Contenu des onglets -->
        <div class="tab-content w-100" id="v-pills-tabContent">
          <!-- Section Enoncé -->
          <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab">
            <div class="row g-4">
              <!-- Carte pour Enoncé -->
              <div class="col-w100">
                <div class="card shadow-sm">
                  <div class="card-body">
                    <h5 class="card-title">Enoncé</h5>
                    <p class="text-secondary">
                     {{exercice.description}}
                    </p>
                  </div>
                </div>
              </div>

              
            </div>
          </div>

          <!-- Section Aide -->
          <div class="tab-pane fade" id="v-pills-profile" role="tabpanel" aria-labelledby="v-pills-profile-tab">
            <div class="card shadow-sm">
              <div class="card-body">
                <h5 class="card-title text-primary">Aide</h5>
                {{exercice.code_initial}}
              </div>
            </div>
          </div>

          <!-- Section Solution -->
          <div class="tab-pane fade" id="v-pills-solution" role="tabpanel" aria-labelledby="v-pills-solution-tab">
              <!-- News & Updates Traffic -->
              <div class="card shadow-sm">
                <div class="card-body pb-3">
                    <h5 class="card-title"></h5>
                    {% for soumission in soumissions %}
                    <div class="news d-flex align-items-center mb-3">
                        <!-- Image -->
                        <img style="height: 50px; width: 50px; border-radius: 50%; object-fit: cover; margin-right: 15px;" 
                             src="{{ soumission.etudiant.photo.url }}" 
                             alt="{{ soumission.etudiant.nom }}">
            
                       
            
                        <!-- Code -->
                        <div class="flex-grow-1">
                           <!-- Nom et Prénom -->
                            <div class="me-3">
                              <h5 class="mb-0">{{ soumission.etudiant.nom }} {{ soumission.etudiant.prenom }}</h4>
                          </div>
                            <pre style="margin: 0;"><code class="language-python">{{ soumission.code_soumis }}</code></pre>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
      </div>
      <!-- Fin des onglets -->
    </div>
  </div>

   <!-- Section Éditeur de Code -->
   <!-- Section Éditeur de Code -->
   {% if messages %}
   {% for message in messages %}
       <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
           {{ message }}
           <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
       </div>
   {% endfor %}
   {% endif %}
   <div class="card shadow-sm mt-4">
    <form method="post">
        {% csrf_token %}
        <!-- Header avec boutons -->
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center rounded-top">
            <h5 class="mb-0">Espace de Codage</h5>
            <div class="d-flex justify-content-end">
                {% if soumission.est_correct %}
                <button name="partager" type="submit" class="btn btn-success btn-sm me-2">Partager</button>
                {% endif %}
                <button name="executer" type="submit" class="btn btn-light btn-sm me-2">Exécuter</button>
            </div>
        </div>
        

        <!-- Corps de la carte -->
        <div class="card-body">
            <!-- Zone d'édition de CodeMirror -->
            <textarea id="code-editor" name="code_soumis">{{ soumission.code_soumis }}</textarea>
        </div>

        <!-- Pied de la carte avec résultats -->
        <div class="card-footer bg-light">
            {% if soumission.sortie %}
            <div class="alert alert-success mt-3">
                <strong>Résultat :</strong>
                <pre>{{ soumission.sortie }}</pre>
            </div>
            {% endif %}
        
            {% if soumission.erreur %}
            <div class="alert alert-danger mt-3">
                <strong>Erreur :</strong>
                <pre>{{ soumission.erreur }}</pre>
            </div>
            {% endif %}
        </div>
    </form>
</div>


    
      
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const editor = CodeMirror.fromTextArea(document.getElementById('code-editor'), {
          mode: "python",
          theme: "Solarized Light",
          lineNumbers: true,
          autoCloseBrackets: true,
          matchBrackets: true,
         
        });
        editor.setSize("100%", "200px");
      });
    </script>
    
</main>
{% endblock %}
